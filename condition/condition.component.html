<ion-header>
  <ion-toolbar color="primary">
    <ion-title>{{Condition.Title}}</ion-title>
    <ion-buttons slot="primary">
      <ion-button title="{{'erp.app.components.list-toolbar.add' | translate}}" (click)="addConditionForm()">
          <ion-icon slot="icon-only" name="add-outline"></ion-icon>
      </ion-button>
      <ion-button title="{{'erp.app.pages.sale.sale-order.merge.close-modal' | translate}}" (click)="closeModal()">
          <ion-icon slot="icon-only" name="close"></ion-icon>
      </ion-button>
  </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content appScrollbarTheme class="ion-padding">
  <app-page-message [itemsLength]="ConditionForm.length" [showSpinner]="pageConfig.showSpinner"></app-page-message>
  <div id="pr-condition" style="position: absolute; z-index: 30005;"></div>
  <div class="table-contain">
    <section class="table">
      <form [formGroup]="formGroup">
      <ng-container formArrayName="ConditionForm">                       
        <div class="row"  *ngFor="let c of ConditionForm.controls; let i=index">
          <ng-container [formGroup]="c" >    
              <div class="cell col-attribute">
                <ng-select (change)="changeAttributeOption(c)" [clearable]="false"  appendTo="#pr-condition" formControlName="Attribute" class="c-input" [items]="AttributeOption"  bindLabel="Name" bindValue="Code" placeholder="Lọc theo"></ng-select>           
              </div>
              <div class="cell" *ngIf="c.controls.Remark.value=='string'">
                <ng-select (change)="saveItemChange(c)"  [clearable]="false"  appendTo="#pr-condition" formControlName="Operator" class="c-input" [items]="c.controls._OperatorOption.value" bindLabel="Name" bindValue="Id" placeholder="So sánh"></ng-select>           
              </div>  
              <div class="cell">
                <ng-select *ngIf="c.controls.Remark.value=='select'"  [multiple]="true" (change)="saveItemChange(c)"  [clearable]="true"  appendTo="#pr-condition" formControlName="Value" class="c-input" [items]="c.controls._ItemDataSource.value | async" [typeahead]="c.controls._ItemSearchInput.value" [loading]="c.controls._ItemSearchLoading.value" [virtualScroll]="true" bindLabel="Name" bindValue="Id" placeholder="Tìm "></ng-select>
                <input *ngIf="c.controls.Remark.value=='string'" type="text" (change)="saveItemChange(c)" formControlName="Value" class="c-input" placeholder="Value">
                <ion-toggle  class="ion-float-right" *ngIf="c.controls.Remark.value=='bool'" (ionChange)="saveItemChange(c)" formControlName="Value"></ion-toggle>
              </div>               
              <div class="ion-float-right">
                <ion-button color="danger" (click)="removeConditionForm(i,c)" fill="outline" slot="end" size="small"><ion-icon  name="trash-outline"></ion-icon></ion-button>                
              </div>                                                 
          </ng-container> 
        </div>
      </ng-container>  
      </form>
    </section>
  </div>        
  <ng-container *ngIf="items?.length>0 && Condition.Type != 'REWARD'">
    <ion-item lines="none" class="border ion-margin-top">
      <ion-text>Tìm thấy</ion-text>
      <ion-label slot="end">{{Count}} 
        <ion-text *ngIf="Condition.Type=='ITEM'">Sản phẩm</ion-text>
        <ion-text *ngIf="Condition.Type=='CONTACT'">Đối tượng</ion-text>
      </ion-label>
    </ion-item>
    
  </ng-container>
</ion-content>
<ion-footer *ngIf="Condition.Type != 'REWARD'">
  <ion-toolbar>
    <ion-button expand="block" (click)="applyData()">Áp dụng</ion-button>
  </ion-toolbar>
</ion-footer>